module.exports=[38259,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(50944),e=a.i(6704),f=a.i(46271),g=a.i(97045),h=a.i(27045);function i({logs:a,view:d}){let e=(0,c.useMemo)(()=>{if(!a?.length)return[];let b={};for(let c of a){let a=new Date(c.timestamp||c.createdAt);if(isNaN(a.getTime()))continue;let e="";if("hourly"===d)e=`${a.getFullYear()}-${String(a.getMonth()+1).padStart(2,"0")}-${String(a.getDate()).padStart(2,"0")} ${String(a.getHours()).padStart(2,"0")}:00`;else if("daily"===d)e=`${a.getFullYear()}-${String(a.getMonth()+1).padStart(2,"0")}-${String(a.getDate()).padStart(2,"0")}`;else{let b=new Date(a.getFullYear(),0,1),c=Math.ceil(((a.getTime()-b.getTime())/864e5+b.getDay()+1)/7);e=`${a.getFullYear()}-W${c}`}b[e]||(b[e]={sum:0,count:0,ts:a.getTime()}),b[e].sum+=c.drowsiness??0,b[e].count+=1}return Object.entries(b).map(([a,{sum:b,count:c,ts:d}])=>({period:a,avg:b/c,ts:d})).sort((a,b)=>a.ts-b.ts)},[a,d]),h={labels:e.map(a=>{if("weekly"===d)return a.period;let b=new Date(a.ts);return"hourly"===d?b.toLocaleString([],{month:"short",day:"numeric",hour:"numeric"}):"daily"===d?b.toLocaleDateString([],{month:"short",day:"numeric"}):a.period}),datasets:[{label:`Avg Drowsiness (${d.charAt(0).toUpperCase()+d.slice(1)})`,data:e.map(a=>a.avg),borderColor:"#2563EB",backgroundColor:"rgba(37, 99, 235, 0.2)",tension:.3,fill:!0,pointRadius:4,pointHoverRadius:7,pointBackgroundColor:"#2563EB"}]},i={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{callbacks:{label:a=>`Avg Drowsiness: ${a.parsed.y.toFixed(2)}`}}},scales:{y:{min:0,max:1,title:{display:!0,text:"Drowsiness Level"}},x:{title:{display:!0,text:d.charAt(0).toUpperCase()+d.slice(1)}}}};return(0,b.jsx)(f.motion.div,{className:"flex flex-col flex-1",initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:(0,b.jsx)("div",{className:"flex-1 min-h-[300px]",children:(0,b.jsx)(g.Line,{data:h,options:i})})})}function j({logs:a,view:c}){let d=a.reduce((a,b)=>(b.emotion&&(a[b.emotion]=(a[b.emotion]||0)+1),a),{}),e={labels:Object.keys(d),datasets:[{data:Object.values(d),backgroundColor:["#3B82F6","#EF4444","#10B981","#F59E0B","#8B5CF6","#EC4899","#6366F1","#14B8A6"],borderWidth:2,borderColor:"#fff"}]};return(0,b.jsxs)(f.motion.div,{className:"flex-1 h-[300px]",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.4},children:[(0,b.jsxs)("div",{className:"text-xs text-gray-500 mb-2 text-right",children:["hourly"===c&&"Last 7 days","daily"===c&&"Last 15 days","weekly"===c&&"Last 90 days"]}),(0,b.jsx)("div",{className:"w-full h-full",children:(0,b.jsx)(g.Pie,{data:e,options:{responsive:!0,maintainAspectRatio:!1,animation:!1,plugins:{legend:{display:!0,position:"right"},tooltip:{enabled:!0}}}})})]})}function k({logs:a}){let d=(0,c.useMemo)(()=>{if(!a.length)return null;let b=a.map(a=>a.drowsiness??0),c=b.reduce((a,b)=>a+b,0)/b.length,d={};for(let b of a)b.emotion&&(d[b.emotion]=(d[b.emotion]||0)+1);let e=Object.entries(d).sort((a,b)=>b[1]-a[1])[0]?.[0]||"Unknown",f={HAPPY:1,CALM:1,NEUTRAL:.8,SAD:.5,ANGRY:.3,UNKNOWN:.7}[e.toUpperCase()]??.7,g=Math.max(0,Math.round((1-c)*70+30*f)),h="Good performance.";return c>.6||f<.5?h="Take a break — you seem tired or stressed.":(c>.4||f<.7)&&(h="Drive carefully — alertness or mood dropping."),{avgDrowsiness:c,frequentEmotion:e,drivingScore:g,suggestion:h}},[a]);if(!d)return(0,b.jsx)("p",{className:"text-gray-500 text-center mt-6",children:"No data available."});let e=[{title:"Avg Drowsiness",value:`${(100*d.avgDrowsiness).toFixed(2)}%`,color:"from-blue-400 to-blue-600",svg:(0,b.jsx)("svg",{className:"w-6 h-6 text-blue-500",fill:"none",stroke:"currentColor",strokeWidth:2,viewBox:"0 0 24 24",children:(0,b.jsx)("circle",{cx:"12",cy:"12",r:"10"})})},{title:"Frequent Emotion",value:d.frequentEmotion.toUpperCase(),color:"from-purple-400 to-purple-600",svg:(0,b.jsx)("svg",{className:"w-6 h-6 text-purple-500",fill:"none",stroke:"currentColor",strokeWidth:2,viewBox:"0 0 24 24",children:(0,b.jsx)("rect",{x:"4",y:"4",width:"16",height:"16",rx:"3"})})},{title:"Driving Score",value:d.drivingScore,color:"from-green-400 to-green-600",svg:(0,b.jsx)("svg",{className:"w-6 h-6 text-green-500",fill:"none",stroke:"currentColor",strokeWidth:2,viewBox:"0 0 24 24",children:(0,b.jsx)("path",{d:"M3 12h18M12 3v18"})})},{title:"Suggestion",value:d.suggestion,color:"from-amber-400 to-amber-600",svg:(0,b.jsx)("svg",{className:"w-6 h-6 text-amber-500",fill:"none",stroke:"currentColor",strokeWidth:2,viewBox:"0 0 24 24",children:(0,b.jsx)("polygon",{points:"12,2 22,22 2,22"})})}];return(0,b.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 w-full",children:e.map((a,c)=>(0,b.jsxs)(f.motion.div,{className:"w-full bg-white rounded-2xl shadow-lg p-6 hover:scale-105 transition-transform relative overflow-hidden",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.1*c},children:[(0,b.jsx)("div",{className:`absolute top-0 left-0 w-full h-1 bg-gradient-to-r ${a.color}`}),(0,b.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,b.jsx)("h3",{className:"text-sm font-medium text-gray-500",children:a.title}),a.svg]}),(0,b.jsx)("p",{className:"text-xl font-bold text-gray-800 leading-snug",children:a.value})]},c))})}h.Chart.register(h.LineElement,h.CategoryScale,h.LinearScale,h.PointElement,h.Tooltip,h.Legend),h.Chart.register(h.ArcElement,h.Tooltip,h.Legend);function l(){let a=(0,d.useRouter)(),[g,h]=(0,c.useState)([]),[l,m]=(0,c.useState)(!0),[n,o]=(0,c.useState)("hourly"),[p,q]=(0,c.useState)("7d"),[r,s]=(0,c.useState)(""),[t,u]=(0,c.useState)("");(0,c.useEffect)(()=>{window.location.href="/login";let b=localStorage.getItem("driverId");b&&(async()=>{try{let a=await fetch(`/api/logs/driver?driverId=${b}`,{headers:{Authorization:"Bearer null"}});if(!a.ok)throw Error("Failed to fetch logs");let c=await a.json();h(c.logs)}catch(b){e.default.error(b.message||"Failed to load dashboard"),a.push("/login")}finally{m(!1)}})()},[a]);let v=(0,c.useMemo)(()=>{let a;if(!g?.length)return[];let b=new Date,c=b;if("custom"===p&&r&&t){let b=new Date(r),d=new Date(t);if(isNaN(b.getTime())||isNaN(d.getTime()))return g;a=b,c=d}else a=new Date,"7d"===p?a.setDate(b.getDate()-7):"15d"===p?a.setDate(b.getDate()-15):"90d"===p?a.setDate(b.getDate()-90):a.setDate(b.getDate()-7);return g.filter(b=>{let d=new Date(b.timestamp||b.createdAt);return!isNaN(d.getTime())&&d>=a&&d<=c})},[g,p,r,t]);return l?(0,b.jsxs)("div",{className:"min-h-screen flex flex-col items-center justify-center gap-6 bg-gray-50",children:[(0,b.jsx)(f.motion.div,{className:"w-64 h-6 bg-gray-200 rounded-full",animate:{opacity:[.3,.7,.3]},transition:{repeat:1/0,duration:1.2}}),(0,b.jsx)(f.motion.div,{className:"w-80 h-48 bg-gray-200 rounded-2xl",animate:{opacity:[.3,.7,.3]},transition:{repeat:1/0,duration:1.2,delay:.2}})]}):(0,b.jsxs)("div",{className:"min-h-screen w-full bg-gray-50 flex flex-col items-stretch",children:[(0,b.jsxs)("div",{className:"flex flex-col md:flex-row items-center justify-between mt-16 px-6 md:px-12 gap-4",children:[(0,b.jsx)(f.motion.h1,{className:"text-4xl font-bold text-gray-800 text-center md:text-left",initial:{y:-20,opacity:0},animate:{y:0,opacity:1},transition:{duration:.6},children:"Driver Dashboard"}),(0,b.jsxs)(f.motion.div,{className:"flex flex-col sm:flex-row items-center gap-3",initial:{opacity:0},animate:{opacity:1},transition:{duration:.6,delay:.2},children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("span",{className:"text-sm text-gray-600",children:"Range:"}),(0,b.jsxs)("select",{className:"border border-gray-300 rounded-md px-3 py-1 text-sm bg-white focus:ring-1 focus:ring-blue-400",value:p,onChange:a=>q(a.target.value),children:[(0,b.jsx)("option",{value:"7d",children:"Last 7 days"}),(0,b.jsx)("option",{value:"15d",children:"Last 15 days"}),(0,b.jsx)("option",{value:"90d",children:"Last 90 days"}),(0,b.jsx)("option",{value:"custom",children:"Custom"})]})]}),"custom"===p&&(0,b.jsxs)("div",{className:"flex items-center gap-2 text-xs sm:text-sm",children:[(0,b.jsxs)("label",{className:"flex items-center gap-1",children:[(0,b.jsx)("span",{className:"text-gray-600",children:"From:"}),(0,b.jsx)("input",{type:"date",className:"border border-gray-300 rounded-md px-2 py-1 bg-white",value:r,onChange:a=>s(a.target.value)})]}),(0,b.jsxs)("label",{className:"flex items-center gap-1",children:[(0,b.jsx)("span",{className:"text-gray-600",children:"To:"}),(0,b.jsx)("input",{type:"date",className:"border border-gray-300 rounded-md px-2 py-1 bg-white",value:t,onChange:a=>u(a.target.value)})]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("span",{className:"text-sm text-gray-600",children:"Resolution:"}),(0,b.jsxs)("select",{className:"border border-gray-300 rounded-md px-3 py-1 text-sm bg-white focus:ring-1 focus:ring-blue-400",value:n,onChange:a=>o(a.target.value),children:[(0,b.jsx)("option",{value:"hourly",children:"Hourly"}),(0,b.jsx)("option",{value:"daily",children:"Daily"}),(0,b.jsx)("option",{value:"weekly",children:"Weekly"})]})]})]})]}),(0,b.jsx)(f.motion.div,{className:"w-full mt-12 flex flex-col md:flex-row gap-6 px-6 md:px-12",initial:{opacity:0},animate:{opacity:1},transition:{duration:.6,delay:.2},children:(0,b.jsx)(k,{logs:v})}),(0,b.jsxs)("div",{className:"w-full mt-16 flex flex-col lg:flex-row gap-6 px-6 md:px-12 pb-12",children:[(0,b.jsxs)(f.motion.div,{className:"lg:flex-[2] bg-white rounded-2xl shadow-lg p-6 min-h-[400px]",initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{duration:.6,delay:.3},children:[(0,b.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Drowsiness Trends"}),(0,b.jsx)(i,{logs:v,view:n})]}),(0,b.jsxs)(f.motion.div,{className:"lg:flex-[1] bg-white rounded-2xl shadow-lg p-6 min-h-[400px]",initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{duration:.6,delay:.4},children:[(0,b.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Emotion Distribution"}),(0,b.jsx)(j,{logs:v,view:n})]})]})]})}a.s(["default",()=>l],38259)}];

//# sourceMappingURL=app_dashboard_Dashboard_tsx_698501f8._.js.map