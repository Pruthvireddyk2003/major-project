(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,55441,e=>{"use strict";var t=e.i(43476),a=e.i(71645),i=e.i(18566),s=e.i(5766),l=e.i(46932),r=e.i(81097),o=e.i(29530);function n({logs:e,view:i}){let s=(0,a.useMemo)(()=>{if(!e?.length)return[];let t={};for(let a of e){let e=new Date(a.timestamp||a.createdAt);if(isNaN(e.getTime()))continue;let s="";if("hourly"===i)s=`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")} ${String(e.getHours()).padStart(2,"0")}:00`;else if("daily"===i)s=`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`;else{let t=new Date(e.getFullYear(),0,1),a=Math.ceil(((e.getTime()-t.getTime())/864e5+t.getDay()+1)/7);s=`${e.getFullYear()}-W${a}`}t[s]||(t[s]={sum:0,count:0,ts:e.getTime()}),t[s].sum+=a.drowsiness??0,t[s].count+=1}return Object.entries(t).map(([e,{sum:t,count:a,ts:i}])=>({period:e,avg:t/a,ts:i})).sort((e,t)=>e.ts-t.ts)},[e,i]),o={labels:s.map(e=>{if("weekly"===i)return e.period;let t=new Date(e.ts);return"hourly"===i?t.toLocaleString([],{month:"short",day:"numeric",hour:"numeric"}):"daily"===i?t.toLocaleDateString([],{month:"short",day:"numeric"}):e.period}),datasets:[{label:`Avg Drowsiness (${i.charAt(0).toUpperCase()+i.slice(1)})`,data:s.map(e=>e.avg),borderColor:"#2563EB",backgroundColor:"rgba(37, 99, 235, 0.2)",tension:.3,fill:!0,pointRadius:4,pointHoverRadius:7,pointBackgroundColor:"#2563EB"}]},n={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{callbacks:{label:e=>`Avg Drowsiness: ${e.parsed.y.toFixed(2)}`}}},scales:{y:{min:0,max:1,title:{display:!0,text:"Drowsiness Level"}},x:{title:{display:!0,text:i.charAt(0).toUpperCase()+i.slice(1)}}}};return(0,t.jsx)(l.motion.div,{className:"flex flex-col flex-1",initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:(0,t.jsx)("div",{className:"flex-1 min-h-[300px]",children:(0,t.jsx)(r.Line,{data:o,options:n})})})}function d({logs:e,view:a}){let i=e.reduce((e,t)=>(t.emotion&&(e[t.emotion]=(e[t.emotion]||0)+1),e),{}),s={labels:Object.keys(i),datasets:[{data:Object.values(i),backgroundColor:["#3B82F6","#EF4444","#10B981","#F59E0B","#8B5CF6","#EC4899","#6366F1","#14B8A6"],borderWidth:2,borderColor:"#fff"}]};return(0,t.jsxs)(l.motion.div,{className:"flex-1 h-[300px]",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.4},children:[(0,t.jsxs)("div",{className:"text-xs text-gray-500 mb-2 text-right",children:["hourly"===a&&"Last 7 days","daily"===a&&"Last 15 days","weekly"===a&&"Last 90 days"]}),(0,t.jsx)("div",{className:"w-full h-full",children:(0,t.jsx)(r.Pie,{data:s,options:{responsive:!0,maintainAspectRatio:!1,animation:!1,plugins:{legend:{display:!0,position:"right"},tooltip:{enabled:!0}}}})})]})}function c({logs:e}){let i=(0,a.useMemo)(()=>{if(!e.length)return null;let t=e.map(e=>e.drowsiness??0),a=t.reduce((e,t)=>e+t,0)/t.length,i={};for(let t of e)t.emotion&&(i[t.emotion]=(i[t.emotion]||0)+1);let s=Object.entries(i).sort((e,t)=>t[1]-e[1])[0]?.[0]||"Unknown",l={HAPPY:1,CALM:1,NEUTRAL:.8,SAD:.5,ANGRY:.3,UNKNOWN:.7}[s.toUpperCase()]??.7,r=Math.max(0,Math.round((1-a)*70+30*l)),o="Good performance.";return a>.6||l<.5?o="Take a break — you seem tired or stressed.":(a>.4||l<.7)&&(o="Drive carefully — alertness or mood dropping."),{avgDrowsiness:a,frequentEmotion:s,drivingScore:r,suggestion:o}},[e]);if(!i)return(0,t.jsx)("p",{className:"text-gray-500 text-center mt-6",children:"No data available."});let s=[{title:"Avg Drowsiness",value:`${(100*i.avgDrowsiness).toFixed(2)}%`,color:"from-blue-400 to-blue-600",svg:(0,t.jsx)("svg",{className:"w-6 h-6 text-blue-500",fill:"none",stroke:"currentColor",strokeWidth:2,viewBox:"0 0 24 24",children:(0,t.jsx)("circle",{cx:"12",cy:"12",r:"10"})})},{title:"Frequent Emotion",value:i.frequentEmotion.toUpperCase(),color:"from-purple-400 to-purple-600",svg:(0,t.jsx)("svg",{className:"w-6 h-6 text-purple-500",fill:"none",stroke:"currentColor",strokeWidth:2,viewBox:"0 0 24 24",children:(0,t.jsx)("rect",{x:"4",y:"4",width:"16",height:"16",rx:"3"})})},{title:"Driving Score",value:i.drivingScore,color:"from-green-400 to-green-600",svg:(0,t.jsx)("svg",{className:"w-6 h-6 text-green-500",fill:"none",stroke:"currentColor",strokeWidth:2,viewBox:"0 0 24 24",children:(0,t.jsx)("path",{d:"M3 12h18M12 3v18"})})},{title:"Suggestion",value:i.suggestion,color:"from-amber-400 to-amber-600",svg:(0,t.jsx)("svg",{className:"w-6 h-6 text-amber-500",fill:"none",stroke:"currentColor",strokeWidth:2,viewBox:"0 0 24 24",children:(0,t.jsx)("polygon",{points:"12,2 22,22 2,22"})})}];return(0,t.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 w-full",children:s.map((e,a)=>(0,t.jsxs)(l.motion.div,{className:"w-full bg-white rounded-2xl shadow-lg p-6 hover:scale-105 transition-transform relative overflow-hidden",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.1*a},children:[(0,t.jsx)("div",{className:`absolute top-0 left-0 w-full h-1 bg-gradient-to-r ${e.color}`}),(0,t.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,t.jsx)("h3",{className:"text-sm font-medium text-gray-500",children:e.title}),e.svg]}),(0,t.jsx)("p",{className:"text-xl font-bold text-gray-800 leading-snug",children:e.value})]},a))})}function m(){return localStorage.getItem("token")}function u(){let e=(0,i.useRouter)(),[r,o]=(0,a.useState)([]),[u,g]=(0,a.useState)(!0),[x,p]=(0,a.useState)("hourly"),[h,y]=(0,a.useState)("7d"),[f,v]=(0,a.useState)(""),[j,b]=(0,a.useState)("");(0,a.useEffect)(()=>{m()||(window.location.href="/login");let t=localStorage.getItem("driverId");t&&(async()=>{try{let e=m(),a=await fetch(`/api/logs/driver?driverId=${t}`,{headers:{Authorization:`Bearer ${e}`}});if(!a.ok)throw Error("Failed to fetch logs");let i=await a.json();o(i.logs)}catch(t){s.default.error(t.message||"Failed to load dashboard"),e.push("/login")}finally{g(!1)}})()},[e]);let w=(0,a.useMemo)(()=>{let e;if(!r?.length)return[];let t=new Date,a=t;if("custom"===h&&f&&j){let t=new Date(f),i=new Date(j);if(isNaN(t.getTime())||isNaN(i.getTime()))return r;e=t,a=i}else e=new Date,"7d"===h?e.setDate(t.getDate()-7):"15d"===h?e.setDate(t.getDate()-15):"90d"===h?e.setDate(t.getDate()-90):e.setDate(t.getDate()-7);return r.filter(t=>{let i=new Date(t.timestamp||t.createdAt);return!isNaN(i.getTime())&&i>=e&&i<=a})},[r,h,f,j]);return u?(0,t.jsxs)("div",{className:"min-h-screen flex flex-col items-center justify-center gap-6 bg-gray-50",children:[(0,t.jsx)(l.motion.div,{className:"w-64 h-6 bg-gray-200 rounded-full",animate:{opacity:[.3,.7,.3]},transition:{repeat:1/0,duration:1.2}}),(0,t.jsx)(l.motion.div,{className:"w-80 h-48 bg-gray-200 rounded-2xl",animate:{opacity:[.3,.7,.3]},transition:{repeat:1/0,duration:1.2,delay:.2}})]}):(0,t.jsxs)("div",{className:"min-h-screen w-full bg-gray-50 flex flex-col items-stretch",children:[(0,t.jsxs)("div",{className:"flex flex-col md:flex-row items-center justify-between mt-16 px-6 md:px-12 gap-4",children:[(0,t.jsx)(l.motion.h1,{className:"text-4xl font-bold text-gray-800 text-center md:text-left",initial:{y:-20,opacity:0},animate:{y:0,opacity:1},transition:{duration:.6},children:"Driver Dashboard"}),(0,t.jsxs)(l.motion.div,{className:"flex flex-col sm:flex-row items-center gap-3",initial:{opacity:0},animate:{opacity:1},transition:{duration:.6,delay:.2},children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{className:"text-sm text-gray-600",children:"Range:"}),(0,t.jsxs)("select",{className:"border border-gray-300 rounded-md px-3 py-1 text-sm bg-white focus:ring-1 focus:ring-blue-400",value:h,onChange:e=>y(e.target.value),children:[(0,t.jsx)("option",{value:"7d",children:"Last 7 days"}),(0,t.jsx)("option",{value:"15d",children:"Last 15 days"}),(0,t.jsx)("option",{value:"90d",children:"Last 90 days"}),(0,t.jsx)("option",{value:"custom",children:"Custom"})]})]}),"custom"===h&&(0,t.jsxs)("div",{className:"flex items-center gap-2 text-xs sm:text-sm",children:[(0,t.jsxs)("label",{className:"flex items-center gap-1",children:[(0,t.jsx)("span",{className:"text-gray-600",children:"From:"}),(0,t.jsx)("input",{type:"date",className:"border border-gray-300 rounded-md px-2 py-1 bg-white",value:f,onChange:e=>v(e.target.value)})]}),(0,t.jsxs)("label",{className:"flex items-center gap-1",children:[(0,t.jsx)("span",{className:"text-gray-600",children:"To:"}),(0,t.jsx)("input",{type:"date",className:"border border-gray-300 rounded-md px-2 py-1 bg-white",value:j,onChange:e=>b(e.target.value)})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{className:"text-sm text-gray-600",children:"Resolution:"}),(0,t.jsxs)("select",{className:"border border-gray-300 rounded-md px-3 py-1 text-sm bg-white focus:ring-1 focus:ring-blue-400",value:x,onChange:e=>p(e.target.value),children:[(0,t.jsx)("option",{value:"hourly",children:"Hourly"}),(0,t.jsx)("option",{value:"daily",children:"Daily"}),(0,t.jsx)("option",{value:"weekly",children:"Weekly"})]})]})]})]}),(0,t.jsx)(l.motion.div,{className:"w-full mt-12 flex flex-col md:flex-row gap-6 px-6 md:px-12",initial:{opacity:0},animate:{opacity:1},transition:{duration:.6,delay:.2},children:(0,t.jsx)(c,{logs:w})}),(0,t.jsxs)("div",{className:"w-full mt-16 flex flex-col lg:flex-row gap-6 px-6 md:px-12 pb-12",children:[(0,t.jsxs)(l.motion.div,{className:"lg:flex-[2] bg-white rounded-2xl shadow-lg p-6 min-h-[400px]",initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{duration:.6,delay:.3},children:[(0,t.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Drowsiness Trends"}),(0,t.jsx)(n,{logs:w,view:x})]}),(0,t.jsxs)(l.motion.div,{className:"lg:flex-[1] bg-white rounded-2xl shadow-lg p-6 min-h-[400px]",initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{duration:.6,delay:.4},children:[(0,t.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Emotion Distribution"}),(0,t.jsx)(d,{logs:w,view:x})]})]})]})}o.Chart.register(o.LineElement,o.CategoryScale,o.LinearScale,o.PointElement,o.Tooltip,o.Legend),o.Chart.register(o.ArcElement,o.Tooltip,o.Legend),e.s(["default",()=>u],55441)}]);